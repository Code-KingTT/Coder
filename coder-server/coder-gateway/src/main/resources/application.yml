server:
  # 统一入口地址
  port: 8080

spring:
  application:
    # 网关服务名
    name: coder-gateway
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848
        namespace: 0adc00be-5992-47c4-8d9b-d22bf950b6b1
        group: DEFAULT_GROUP

    gateway:
      # 全局超时配置
      httpclient:
        connect-timeout: 3000
        response-timeout: 10s

      # 路由配置
      routes:
        # 认证服务路由
        - id: auth-service
          # lb表示负载均衡
          uri: lb://coder-auth
          predicates:
            - Path=/coder/auth/**

        # 用户服务路由
        - id: user-service
          # lb表示负载均衡
          uri: lb://coder-user
          predicates:
            # 路径匹配规则：匹配 /api/user/** 的请求
#            - Path=/api/user/**
            - Path=/coder/**
          filters:
            # 重写路径：将 /api/user/** 重写为 /coder/user/**
            # - RewritePath=/api/user/(?<segment>.*), /coder/user/$\{segment}

        # 文件服务路由
        - id: file-service
          # lb表示负载均衡
          uri: lb://coder-file
          predicates:
            - Path=/coder/**

      # 跨域配置
      globalcors:
        cors-configurations:
          '[/**]':
            allowedOriginPatterns: ["*"]
            allowedMethods: [GET, POST, PUT, DELETE, OPTIONS]
            allowedHeaders: "*"
            allowCredentials: false
            maxAge: 3600

# 日志配置
logging:
  level:
    root: info
    com.coder: debug
    org.springframework.cloud.gateway: debug
    reactor.netty: info
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level [%logger{36}:%line] - %msg%n"
  file:
    name: ./logs/coder-gateway.log

# 网关监控
management:
  endpoints:
    web:
      exposure:
        include:
          - gateway      # 网关端点
          - health       # 健康检查
          - info         # 应用信息
          - metrics      # 性能指标
  endpoint:
    health:
      show-details: always

# JWT配置
jwt:
  # 密钥
  secret: coderServerSecretKeyKingZS20000713Sunset
  # 过期时间（秒）7天
  expiration: 604800
  # Token前缀
  tokenPrefix: Bearer
  # Header名称
  headerName: Authorization